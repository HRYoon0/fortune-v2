<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì˜¤ëŠ˜ì˜ ìš´ì„¸ AIz</title>
  <link type="text/css" rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ë‹¹ì‹ ì˜ ì˜¤ëŠ˜ ìš´ì„¸ë¥¼ ì•Œì•„ë³´ì„¸ìš”</h1>
  <div>
    <img src="./images/main.png">
  </div>

  <form id="fortune-form">
    <label for="name">ì´ë¦„</label>
    <input type="text" id="name" name="name" required />

    <label for="birth">ìƒë…„ì›”ì¼ (ì˜ˆ: 1983-05-15)</label>
    <input type="date" id="birth" name="birth" required />

    <button type="submit">ìš´ì„¸ í™•ì¸í•˜ê¸°</button>
  </form>

  <div id="result"></div>

  <script>
    const form = document.getElementById("fortune-form");
    const resultDiv = document.getElementById("result");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const birth = document.getElementById("birth").value;

      resultDiv.textContent = "ìš´ì„¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";

      try {
        const API_URL = "https://my-fortune-api.tmdsh2000.workers.dev";

        const response = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ name, birth })
        });

        const data = await response.json();

        // ğŸ” ë””ë²„ê¹…ìš© ì½˜ì†” ì¶œë ¥
        console.log("âœ… ì „ì²´ ì‘ë‹µ:", data);
        console.log("ğŸ“¦ Gemini API ìƒíƒœ ì½”ë“œ:", data.debug?.status);
        console.log("ğŸ§  Gemini ì‘ë‹µ ì›ë³¸:", data.debug?.raw);

        if (data.answer) {
          resultDiv.textContent = data.answer;
        } else if (data.error) {
          resultDiv.textContent = `ì˜¤ë¥˜: ${data.error} ${data.details ? '(' + data.details + ')' : ''}`;
        } else {
          resultDiv.textContent = "ì•Œ ìˆ˜ ì—†ëŠ” ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤.";
        }
      } catch (err) {
        resultDiv.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        console.error("âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì˜ˆì™¸:", err);
      }
    });
  </script>
</body>
</html>
